!function(a){var b,c,d,e=['<div class="timepicker" style="opacity:0">','<div id="timepicker-time" class="time">','<span id="timepicker-hour" class="hour"></span>',":",'<span id="timepicker-minute" class="minute"></span>',"</div>",'<div id="timepicker-canvas" class="canvas">','<div id="timepicker-faceH" class="faceH"></div>','<div id="timepicker-faceM" class="faceM"></div>',"</div>","</div>"].join(""),f=['<div id="timepicker-buttons" class="buttons">','<span id="timepicker-cancel-button" class="cancel-button"></span>','<span id="timepicker-done-button" class="done-button"></span>',"</div>"].join(""),g=['<div id="am_pm" class="am_pm">','<span id="ampm_button" class="ampm_button"></span>',"</div>"].join(""),h=400,i=3.5,j=2.5,k=function(a){return parseInt(a+Math.random()*a)},l=function(a){return a=a.toString(),a.length<2&&10>a?"0"+a:a},m="ontouchstart"in window,n="mousedown"+(m?" touchstart":""),o="mousemove"+(m?" touchmove":""),p="mouseup"+(m?" touchend":""),q="vibrate"in navigator,r=function(a,b){a=a||50,b=b||150,clearTimeout(d),d=setTimeout(function(){q&&navigator.vibrate(a)},b)},s=function(b,c){var d=this,h=a(e),i=a(g),j="INPUT"===b.prop("tagName"),l=h.find("span#timepicker-hour"),m=h.find("span#timepicker-minute"),n=h.find("#timepicker-canvas"),o=h.find("#timepicker-faceH"),p=h.find("#timepicker-faceM"),q=j?b:b.find("input");parseInt(n.css("width"),10);if(this.id=k(1e3),this.time_h=l,this.time_m=m,this.face_canvas=n,this.face_h=o,this.face_m=p,this.arrow=null,this.meridiem="AM",this.isOpen=!1,this.isCreated=!1,this.isRotated=!1,this.ampm=i,this.currentView="",this.settings=c,this.input=q,this.fragment=h,this.e=b,c.enable_buttons){var r=a(f);r.find("#timepicker-done-button").html(c.done_text).on("click.done_"+this.id,a.proxy(this.done,this)),!c.always_show&&r.find("#timepicker-cancel-button").html(c.cancel_text).on("click.cancel_"+this.id,a.proxy(this.hide,this)),r.appendTo(h)}c.twelve_hour&&(i.appendTo(h.find("#timepicker-time")),i.find("#ampm_button").html(d.meridiem).on("click.ampm_"+this.id,function(){d.meridiem="AM"==d.meridiem?"PM":"AM",a(this).html(d.meridiem)})),"dark"==c.theme&&h.addClass("timepicker-dark"),c.always_show?this.show():q.on("click.timepicker_"+this.id+" focusin.timepicker_"+this.id,a.proxy(this.show,this))};s["default"]={time:"06:00",autohide:!1,autotogle:!0,enable_head:!0,enable_buttons:!0,always_show:!1,twelve_hour:!1,position:"bottom","float":"center",margin:15,theme:"light",done_text:"Done",cancel_text:"Cancel"},s.prototype.show=function(){this.callback(this.settings.beforeShow);var b,c=this,d=[];this.isOpen||("now"==this.settings.time?(b=new Date,d[0]=l(b.getHours()),d[1]=l(b.getMinutes()),this.settings.twelve_hour&&(this.meridiem=d[0]>11?"PM":"AM",d[0]=d[0]>12||0===d[0]?Math.abs(d[0]-12):d[0])):(d=this.input.val()||this.settings.time,/^[0-9]{1,2}:[0-9]{1,2}(?: [A,P]M)?$/.test(d)||(d=this.settings.time),d=d.split(/[\:\ \-]/),("AM"==d[2]||"PM"==d[2])&&(this.meridiem=d[2]),d[0]>24&&(d[0]-=24),d[1]>60&&(d[1]-=60),!this.settings.twelve_hour&&"PM"==this.meridiem&&d[0]<13&&(d[0]=parseInt(d[0])+12),this.settings.twelve_hour&&d[0]>12&&(d[0]=parseInt(d[0]-12),this.meridiem="PM"),d[0]=l(d[0]),d[1]=l(d[1])),this.isCreated||(this.fragment.appendTo("body").addClass("timepicker_"+this.id),this.drawNum(),this.isCreated=!0,this.time_h.on("click.timeH_"+this.id,a.proxy(this.toggleView,this,"hour",!0)),this.time_m.on("click.timeM_"+this.id,a.proxy(this.toggleView,this,"minute",!0)),a(window).on("resize.timepicker_"+this.id,a.proxy(this.position,this))),this.time_h.html(d[0]),this.time_m.html(d[1]),this.ampm.find("#ampm_button").html(this.meridiem),this.toggleView("hour"),this.fragment.css({display:"block"}).animate({opacity:"1"},h),this.position(),this.isOpen=!0,this.settings.always_show||(a(document).on("mousedown.document.timepicker_"+this.id,function(a){c.input.is(a.target)||c.fragment.is(a.target)||0!==c.fragment.has(a.target).length||c.isRotated||c.hide()}),a(document).on("keyup",function(a){27==a.keyCode&&c.hide(),13==a.keyCode&&c.done()})),this.callback(this.settings.afterShow))},s.prototype.hide=function(){var b=this;this.fragment.animate({opacity:"0"},h),setTimeout(function(){b.fragment.css({display:"none"})},h),this.isOpen=!1,a(document).off("mousedown.document.timepicker_"+this.id),this.callback(this.settings.afterHide)},s.prototype.position=function(){var a,b,c=this.input,d=this.settings.position,e=this.settings["float"],f=this.settings.margin,g=c.offset().top,h=c.offset().left,i=c.outerWidth(),j=c.outerHeight(),k=this.fragment.outerHeight(),l=this.fragment.outerWidth();switch(d){case"bottom":a=g+j+f;break;case"top":a=g-k-f;break;case"left":b=h-l-f;break;case"right":b=h+i+f;break;default:a=g+j+f}switch(e){case"bottom":a=g;break;case"top":a=g-k+j;break;case"left":b=h;break;case"right":b=h-l+i;break;case"center":"top"===d||"bottom"===d?b=h+(i-l)/2:a=g+(j-k)/2;break;default:b=h+(i-l)/2}this.fragment.css({top:a,left:b})},s.prototype.drawNum=function(){var d,e,f,g,h,k=this,l=this.face_canvas.width(),m=this.face_canvas.height(),q=l/8,r=m/8;if(this.settings.twelve_hour)for(h=1;13>h;h++)g=j,e=-Math.cos(h*Math.PI/6)*m/g+m/2-r/2,d=Math.sin(h*Math.PI/6)*l/g+l/2-q/2,f=a("<span data="+h+">"+h+"</span>").css({top:e+"px",left:d+"px",width:q+"px","line-height":r+"px"}),this.face_h.append(f);else for(h=0;24>h;h++)g=0===h||h>12?j:i,e=-Math.cos(h*Math.PI/6)*m/g+m/2-r/2,d=Math.sin(h*Math.PI/6)*l/g+l/2-q/2,f=a("<span data="+h+">"+h+"</span>").css({top:e+"px",left:d+"px",width:q+"px","line-height":r+"px"}),(0===h||h>12)&&f.addClass("outerH"),this.face_h.append(f);for(h=0;60>h;h+=5)g=j,e=-Math.cos(h*Math.PI/30)*m/g+m/2-r/2,d=Math.sin(h*Math.PI/30)*l/g+l/2-q/2,f=a("<span data="+h+">"+h+"</span>").css({top:e+"px",left:d+"px",width:q+"px","line-height":r+"px"}),this.face_m.append(f);b=[l/i-q/2,l/i+q/2],c=[l/j-q/2,l/j+q/2],this.arrow=this.face_canvas.children().is(".arrow")?this.face_canvas.find(".arrow"):a('<div class="arrow" style="opacity:0"></div>').appendTo(this.face_canvas),this.face_canvas.on(n+".canvas_"+this.id,function(b){k.moveArrow(b),k.isRotated||a(document).on(o+".document_"+k.id,a.proxy(k.moveArrow,k)),k.isRotated=!0}),a(document).on(p+".document_"+this.id,function(){a(document).off(o+".document_"+k.id),k.isRotated&&k.settings.autotogle&&k.toggleView("auto"),k.isRotated=!1})},s.prototype.moveArrow=function(a){a.preventDefault();var d,e,f,g,h,i,j,k,m,n=/^touch/.test(a.type),o=this.face_canvas,p=o.width(),q=o.height();if(d=o.offset().left+p/2,e=o.offset().top+q/2,f=(n?a.originalEvent.touches[0]:a).pageX-d,g=(n?a.originalEvent.touches[0]:a).pageY-e,i=Math.sqrt(f*f+g*g),i>b[0]&&i<b[1])j="inner";else{if(!(i>c[0]))return;j="outer"}h=180*Math.atan2(g,f)/Math.PI,h=0>h?h+=360:h,h=h>270?h-270:h+90,"hour"!=this.currentView||this.settings.twelve_hour?"hour"==this.currentView&&this.settings.twelve_hour?(k=Math.round(h/30),k=0===k?12:k,this.drawArrow(c[0],"hour12",k),this.time_h.html(l(k))):"minute"==this.currentView&&(m=Math.round(h/6),m=60==m?0:m,this.drawArrow(c[0],"minute",m),this.time_m.html(l(m))):("inner"==j?(k=Math.round(h/30),k=0===k?12:k,this.drawArrow(b[0],"hour",k)):(k=Math.round(h/30)+12,k=24==k||12==k?0:k,this.drawArrow(c[0],"hour",k)),this.time_h.html(l(k))),r(50,150)},s.prototype.drawArrow=function(a,b,c){var d,e=1;"angle"==b&&(e=1),("hour"==b||"hour12"==b)&&(e=30),"minute"==b&&(e=6),d=c*e,a=parseInt(a),this.arrow.css({"margin-top":"-"+a+"px","padding-top":a+"px",transform:"rotate("+d+"deg)"})},s.prototype.done=function(){var a=this.time_h.html()+":"+this.time_m.html();this.input.val(this.settings.twelve_hour?a+" "+this.meridiem:a),this.settings.always_show||this.hide(),this.callback(this.settings.afterDone)},s.prototype.toggleView=function(a,d){this.callback(this.settings.beforeToggleView);var e,f=this,g=parseInt(this.time_h.html()),i=parseInt(this.time_m.html());if(a!=this.currentView){if(d&&r(50,50),"toggle"==a&&this.toggleView("hour"==this.currentView?"minute":"hour"),"auto"==a)return void("hour"==this.currentView?this.toggleView("minute"):"minute"==this.currentView&&this.settings.autohide&&this.done());"hour"==a&&(e=this.settings.twelve_hour?c:g>12?c:b,setTimeout(function(){f.face_m.css({"z-index":1}),f.drawArrow(e,"hour",g),f.arrow.animate({opacity:1},h)},h),this.face_m.animate({transform:"scale(5)",opacity:0},h),this.arrow.animate({opacity:0},h),this.face_h.css({"z-index":10}).animate({transform:"scale(1)",opacity:1},h),this.time_m.removeClass("active"),this.time_h.addClass("active"),this.currentView="hour"),"minute"==a&&(setTimeout(function(){f.face_h.css({"z-index":1}),f.drawArrow(c,"minute",i),f.arrow.animate({opacity:1},h)},h),this.face_h.animate({transform:"scale(5)",opacity:0},h),this.arrow.animate({opacity:0},h),this.face_m.css({"z-index":10}).animate({transform:"scale(1)",opacity:1},h),this.time_h.removeClass("active"),this.time_m.addClass("active"),this.currentView="minute"),this.callback(this.settings.afterToggleView)}},s.prototype.destroy=function(){this.callback(this.settings.beforeDestroy),this.isOpen&&this.hide(),this.input.off("click.timepicker_"+this.id+" focusin.timepicker_"+this.id),a(window).off("resize.timepicker_"+this.id),this.fragment.remove(),this.isCreated&&this.fragment.remove(),this.e.removeData(),this.callback(this.settings.afterDestroy)},s.prototype.callback=function(a){a&&"function"==typeof a&&a()},a.fn.timePicker=function(b){var c=Array.prototype.slice.call(arguments,1);return this.each(function(){var d=a(this),e=d.data("timepicker");if(e)"function"==typeof e[b]&&e[b].apply(e,c);else{var f=a.extend({},s["default"],d.data(),"object"==typeof b&&b);d.data("timepicker",new s(d,f))}})}}(jQuery);